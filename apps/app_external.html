<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">
    <link type="image/ico" rel="icon" href="https://www.google.com/images/icons/product/chrome-32.png">

    <link href="../static/css/out/site.css" rel="stylesheet" type="text/css">
    <link href="../static/css/print.css" rel="stylesheet" type="text/css" media="print">
    <link href="../static/css/prettify.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700%7CSource+Code+Pro' rel='stylesheet' type='text/css'>
    <title>外部内容 - Google Chrome 应用开发文档（非官方中文版）</title>
  </head>

  <body>
    <div id="gc-container">
    <a href="app_external.html#gc-pagecontent" class="element-invisible element-focusable">Skip to main content</a>

    <header id="topnav" role="banner">
      <div id="logo">
        <a href="../extensions/index.html" id="goto-original">
          <img alt="Chrome 开发者" src="../static/images/chrome-logo_2x.png">
        </a>
        <span class="collase-icon"><!-- <img src="/static/images/burger-icon.png" class="collase-icon">--></span>
      </div>
      <nav id="fatnav" role="navigation">
      <ul>
          <li class="pillar">
            <span class="toplevel">应用</span>
            <ul class="expandee">
                <li class="submenu">了解基础知识
                  <ul>
                      <li class="category">
                        <a href="about_apps.html">
                        什么是 Chrome 应用？
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="first_app.html">
                        创建第一个应用
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_architecture.html">
                        应用的架构
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_lifecycle.html">
                        应用的生命周期
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="contentSecurityPolicy.html">
                        内容安全策略
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_codelab1_setup.html">
                        通过代码实验室学习
                        </a>
                        <ul>
                            <li><a href="app_codelab1_setup.html">1、设置开发环境</a>
                            </li>
                            <li><a href="app_codelab2_basic.html">2、创建基本应用</a>
                            </li>
                            <li><a href="app_codelab3_mvc.html">3、创建 MVC</a>
                            </li>
                            <li><a href="app_codelab5_data.html">4、保存和获取数据</a>
                            </li>
                            <li><a href="app_codelab6_lifecycle.html">5、管理应用的生命周期</a>
                            </li>
                            <li><a href="app_codelab7_useridentification.html">6、访问用户数据</a>
                            </li>
                            <li><a href="app_codelab8_webresources.html">7、访问网络资源</a>
                            </li>
                            <li><a href="app_codelab_10_publishing.html">8、发布应用</a>
                            </li>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">在云端开发
                  <ul>
                      <li class="category">
                        <a href="offline_apps.html">
                        首先考虑离线
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_external.html">
                        处理外部内容
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_storage.html">
                        保存数据
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="inform_users.html">
                        随时通知用户
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="cloudMessaging.html">
                        云消息服务
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="richNotifications.html">
                        丰富的通知
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_identity.html">
                        用户认证
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">使用低级系统服务
                  <ul>
                      <li class="category">
                        <a href="app_usb.html">
                        USB
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_serial.html">
                        串行端口
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_network.html">
                        网络通信
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_bluetooth.html">
                        蓝牙
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">MVC 架构和框架
                  <ul>
                      <li class="category">
                        <a href="app_frameworks.html">
                        关于 MVC 架构
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="angular_framework.html">
                        使用 AngularJS 建立应用
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="sencha_framework.html">
                        使用 SenchaJS 建立应用
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="game_engines.html">
                        游戏引擎
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">发布应用
                  <ul>
                      <li class="category">
                        <a href="publish_app.html">
                        发布您的应用
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="chrome_apps_on_mobile.html">
                        在移动设备上运行 Chrome 应用
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="google_wallet.html">
                        通过应用获利
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="https://developer.chrome.com/webstore/one_time_payments">
                        一次性付款
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="analytics.html">
                        Analytics（分析）
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">Chrome 平台 API
                  <ul>
                      <li class="category">
                        <a href="api_index.html">
                        JavaScript API
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="manifest.html">
                        清单文件格式
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="tags/webview.html">
                        Webview 标签
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="api_other.html">
                        网页 API
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_deprecated.html">
                        禁用的网页特性
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">帮助
                  <ul>
                      <li class="category">
                        <a href="samples.html">
                        示例
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="faq.html">
                        常见问题
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="https://groups.google.com/a/chromium.org/forum/#!forum/chromium-apps">
                        Google 网上论坛
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="http://stackoverflow.com/questions/tagged/google-chrome-app">
                        Stack Overflow
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
            </ul>
          </li>
          <li class="pillar">
            <span class="toplevel">扩展程序</span>
            <ul class="expandee">
                <li class="submenu">了解基础知识
                  <ul>
                      <li class="category">
                        <a href="../extensions/getstarted.html">
                        入门教程
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/overview.html">
                        概述
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/hosting_changes.html">
                        托管扩展程序的更改
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/single_purpose.html">
                        扩展程序质量准测的常见问题
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/event_pages.html">
                        事件页面
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/content_scripts.html">
                        内容脚本
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/activeTab.html">
                        activeTab 权限
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/whats_new.html">
                        新增特性
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">开发扩展程序
                  <ul>
                      <li class="category">
                        <a href="../extensions/a11y.html">
                        辅助功能
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/contentSecurityPolicy.html">
                        内容安全策略
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/xhr.html">
                        跨站 XHR
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/tut_debugging.html">
                        调试
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/i18n.html">
                        国际化支持
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/messaging.html">
                        消息传递
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/tut_migration_to_manifest_v2.html">
                        迁移至清单文件版本 2
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/tut_oauth.html">
                        OAuth
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">发布扩展程序
                  <ul>
                      <li class="category">
                        <a href="../extensions/hosting.html">
                        托管
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/packaging.html">
                        打包
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="https://developer.chrome.com/webstore/one_time_payments">
                        一次性付款
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/autoupdate.html">
                        自动更新
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/external_extensions.html">
                        其他部署选项
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/tut_analytics.html">
                        Google Analytics（分析）
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/themes.html">
                        发布主题
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">Chrome 平台 API
                  <ul>
                      <li class="category">
                        <a href="../extensions/api_index.html">
                        JavaScript API
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/manifest.html">
                        清单文件格式
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/api_other.html">
                        网页 API
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/permission_warnings.html">
                        权限警告
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/permissions.html">
                        可选权限
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/match_patterns.html">
                        匹配表达式
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">帮助
                  <ul>
                      <li class="category">
                        <a href="../extensions/samples.html">
                        示例
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/faq.html">
                        常见问题
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="https://groups.google.com/a/chromium.org/forum/#!forum/chromium-extensions">
                        Google 网上论坛
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="http://stackoverflow.com/tags/google-chrome-extension/info">
                        Stack Overflow
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
            </ul>
          </li>
        <li id="search">
          <img src="../static/images/search.png">
          <div class="expandee">
      
      <!-- override search styles set globally by site.css -->
      <style>.gsc-above-wrapper-area, .gsc-result-info {
        font-size: 11px;
      }
      .gs-webResult div, .gs-result div {
        line-height: initial;
      }
      .gs-webResult a, .gs-result a {
        text-decoration: none;
      }
      td.gcsc-branding-img-noclear, .gcsc-branding-img-noclear a {
        width: 51px;
        height: 15px;
        vertical-align: top;
      }
      .gsc-table-result, .gsc-thumbnail-inside, .gsc-url-top {
        padding: 0;
      }
      .gsc-control-cse tr, .gsc-control-cse td, .gsc-control-cse th {
       padding: inherit;
       border: none;
      }
      .gsc-control-cse {
        white-space: normal;
        border: none;
        padding: 0 1em;
      }
      #search .gsc-control-cse img {
        height: inherit;
        width: inherit;
      }
      .gsc-control-cse table {
        margin: initial;
      }
      .gsc-control-cse * {
        box-sizing: initial;
        -webkit-box-sizing: initial;
        -moz-box-sizing: initial;
      }
      #fatnav .expandee .gsc-control-cse a {
       padding: 0;
       color: inherit;
      }
      </style>
      
            <form id="chrome-docs-cse-search-form" action="https://www.google.com/cse">
              <input type="search" id="chrome-docs-cse-input" name="q" placeholder="What are you looking for?">
              <input type="hidden" name="cx" value="016591469675702421090:ddw412-4i6q" />
              <input type="hidden" name="ie" value="UTF-8" />
            </form>
            <gcse:searchresults-only gname="results"></gcse:searchresults-only>
          </div>
        </li>
      </ul>
      </nav>
          </header>

    <main id="gc-pagecontent" role="main">


<article class="article-content">
  <div itemprop="articleBody">

<h1><!--@External Content-->外部内容</h1>


<p>
<!--@The <a href="app_architecture#security">Chrome Apps security model</a> disallows
external content in iframes and
the use of inline scripting and <code>eval()</code>.
You can override these restrictions,
but your external content must be isolated from the app.-->
<a href="app_architecture.html#security">Chrome 应用的安全模型</a>不允许
iframe 中的外部内容，也不允许使用内嵌脚本与
<code>eval()</code>。您可以覆盖这些限制，但是您的外部内容必须与应用程序隔离。
</p>

<p>
<!--@Isolated content cannot directly
access the app's data or any of the APIs.
Use cross-origin XMLHttpRequests
and post-messaging to communicate between the event page and sandboxed content
and indirectly access the APIs.-->
隔离的内容不能直接访问应用程序的数据或任何 API，但可以使用跨站
XMLHttpRequest 及消息传递在事件页面和经过沙盒屏蔽的内容间通信，并间接访问
API。
</p>

<p class="note">
<b>API <!--@Sample: -->示例：</b><!--@
Want to play with the code?
Check out the-->想试试这些代码吗？请参见
<a href="https://github.com/GoogleChrome/chrome-app-samples/tree/master/sandbox">sandbox</a> <!--@sample.-->
示例。
</p>

<h2 id="external"><!--@Referencing external resources-->引用外部资源</h2>

<p>
<!--@The <a href="contentSecurityPolicy">Content Security Policy</a> used by apps disallows
the use of many kinds of remote URLs, so you can't directly reference external
images, stylesheets, or fonts from an app page. Instead, you can use use
cross-origin XMLHttpRequests to fetch these resources,
and then serve them via <code>blob:</code> URLs.-->
应用使用的<a href="contentSecurityPolicy.html">内容安全策略</a>不允许多种类型的远程
URL，所以您不能从应用页面中直接引用外部图像、样式表或字体。相反，您可以使用跨站
XMLHttpRequest 获取这些资源，并通过 <code>blob:</code> URL 来使用它们。
</p>

<h3 id="manifest"><!--@Manifest requirement-->清单文件的要求</h3>

<p>
<!--@To be able to do cross-origin XMLHttpRequests, you'll need to add a permission
for the remote URL's host:-->
为了能够发出跨来源 XMLHttpRequest 请求，您需要为远程 URL 的主机添加权限：
</p>

<pre data-filename="manifest.json">
"permissions": [
    "...",
    "https://supersweetdomainbutnotcspfriendly.com/"
  ]
</pre>

<h3 id="cross-origin"><!--@Cross-origin-->跨站 XMLHttpRequest</h3>

<p>
<!--@Fetch the remote URL into the app and serve its contents as a-->
将远程 URL 获取进应用并通过
<code>blob:</code>
URL<!--@:-->
来使用它的内容：
</p>

<pre>
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://supersweetdomainbutnotcspfriendly.com/image.png', true);
xhr.responseType = 'blob';
xhr.onload = function(e) {
  var img = document.createElement('img');
  img.src = window.URL.createObjectURL(this.response);
  document.body.appendChild(img);
};

xhr.send();
</pre>

<p><!--@You may want to <a href="offline_apps#saving-locally">save</a>
these resources locally, so that they are available offline.-->
您可能希望在本地<a href="offline_apps.html#saving-locally"
>保存</a>这些资源，这样它们在离线状态下也可以使用。
</p>

<h2 id="webview"><!--@Embed external web pages-->嵌入外部网页</h2>

<p class="note">
<b>API <!--@Sample: -->示例：</b><!--@
Want to play with the code? Check out the-->想试试这些代码吗？请参见
<a href="https://github.com/GoogleChrome/chrome-app-samples/tree/master/browser">browser</a>
<!--@sample.-->
示例。
</p>

<p>
<!--@The <code>webview</code> tag allows you to embed external web content in your
app, for example, a web page. It replaces iframes that point to remote URLs,
which are disabled inside Chrome Apps. Unlike iframes, the
<code>webview</code> tag runs in a separate process. This means that an exploit
inside of it will still be isolated and won't be able to gain elevated
privileges. Further, since its storage (cookies, etc.) is isolated from the app,
there is no way for the web content to access any of the app's data.-->
<code>webview</code>
标签允许您在您的应用中嵌入外部网络内容，例如一个网页。它替换了指向远程 URL
的 iframe，在 Chrome 应用内这是禁用的。与 iframe 不同，<code>webview</code>
标签运行在单独的进程中，这意味着它内部的攻击仍然会被隔离开来，不能获得提升的权限。此外，由于它的存储区（Cookie 等）与应用隔离，没有办法让网络内容访问应用的任何数据。
</p>

<h3 id="webview_element"><!--@Add webview element-->添加 webview 元素</h3>

<p>
<!--@Your <code>webview</code> element must include the URL to the source content
and specify its dimensions.-->
您的 webview 元素必须包含来源内容的 URL 并指定大小。
</p>

<pre data-filename="browser.html">
&lt;webview src="http://news.google.com/" width="640" height="480">&lt;/webview>
</pre>

<h3 id="properties"><!--@Update properties-->更新属性</h3>

<p>
<!--@To dynamically change the <code>src</code>, <code>width</code> and
<code>height</code> properties of a <code>webview</code> tag, you can either
set those properties directly on the JavaScript object, or use the
<code>setAttribute</code> DOM function.-->
要动态更改 <code>webview</code> 标签的 <code>src</code>、<code>width</code>
和 <code>height</code> 属性，您既可以直接在 <code>JavaScript</code>
对象上设置这些属性，也可以使用 DOM 函数 <code>setAttribute</code>。
</p>

<pre data-filename="browser.js">
document.querySelector('#mywebview').src =
    'http://blog.chromium.org/';
// 或
document.querySelector('#mywebview').setAttribute(
    'src', 'http://blog.chromium.org/');
</pre>

<h2 id="sandboxing"><!--@Sandbox local content-->通过沙盒保护本地内容</h2>

<p>
<!--@Sandboxing allows specified pages
to be served in a sandboxed, unique origin.
These pages are then exempt from their Content Security Policy.
Sandboxed pages can use iframes, inline scripting,
and <code>eval()</code>.
Check out the manifest field description for
<a href="manifest/sandbox">sandbox</a>.-->
沙盒功能允许指定页面在经过沙盒屏蔽的唯一来源中运行，这些页面就不受内容安全策略的限制。经过沙盒屏蔽的页面可以使用 iframe、内嵌脚本以及
<code>eval()</code>。请查阅 <a href="manifest/sandbox.html">sandbox</a>
清单文件字段的描述。
</p>

<p>
<!--@It's a trade-off though:
sandboxed pages can't use the chrome.* APIs.
If you need to do things like <code>eval()</code>,
go this route to be exempt from CSP,
but you won't be able to use the cool new stuff.-->
不过这也是一个权衡的问题：经过沙盒屏蔽的页面不能使用 chrome.*
API。如果您需要做一些类似于 <code>eval()</code>
的事情，请使用这种方法免受
CSP（内容安全策略）的限制，但是您也不能使用一些很棒的新功能。
</p>

<h3 id="inline_scripts"><!--@Use inline scripts in sandbox-->在沙盒中使用内嵌脚本</h3>

<p>
<!--@Here's a sample sandboxed page which uses an inline script and <code>eval()</code>:-->
如下是一个经过沙盒屏蔽的页面示例，使用了内嵌脚本与
<code>eval()</code>：
</p>

<pre data-filename="sandboxed.html">
&lt;html&gt;
  &lt;body&gt;
    &lt;h1&gt;Woot&lt;/h1&gt;
    &lt;script&gt;
      eval('console.log(\'这是使用了 eval 的内嵌脚本。\')');
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>

<h3 id="include_sandbox"><!--@Include sandbox in manifest-->在清单文件中包含 sandbox</h3>

<p>
<!--@You need to include the <code>sandbox</code> field in the manifest
and list the app pages to be served in a sandbox:-->
您需要在清单文件中包含 <code>sandbox</code>
字段，并列出需要在沙盒中运行的应用页面：
</p>

<pre data-filename="manifest.json">
"sandbox": {
  "pages": ["sandboxed.html"]
}
</pre>

<h3 id="opening_sandbox"><!--@Opening a sandboxed page in a window-->在窗口中打开经过沙盒屏蔽的页面</h3>

<p>
<!--@Just like any other app pages,
you can create a window that the sandboxed page opens in.
Here's a sample that creates two windows,
one for the main app window that isn't sandboxed,
and one for the sandboxed page:-->
就像其他应用页面一样，您可以创建一个窗口，打开经过沙盒屏蔽的页面。如下是一个示例，它创建了两个窗口，一个用于应用主窗口，不经过沙盒屏蔽，另一个用于经过沙河屏蔽的页面：
</p>

<p class="warning">
<!--@NOTE:
-->注意：使用经过沙盒屏蔽的页面创建窗口时会遇到<a href="https://code.google.com/p/chromium/issues/detail?id=154662"><!--@issue-->问题 154662</a><!--@
is a bug when using sandbox pages to create windows.
The effect is that an error "Uncaught TypeError: Cannot call method
'initializeAppWindow' of undefined" is output to the developer console
and that the app.window.create call does not call the callback function
with a window object. However, the sandbox page is created as a new window.-->，开发者控制台中会输出错误“Uncaught
TypeError: Cannot call method 'initializeAppWindow' of
undefined”，而且 app.window.create
不会调用回调函数，并传递窗口对象。但还是会创建新窗口，打开经过沙盒屏蔽的页面。
</p>

<pre data-filename="background.js">
chrome.app.runtime.onLaunched.addListener(function() {
  chrome.app.window.create('window.html', {
    'bounds': {
      'width': 400,
      'height': 400,
      'left': 0,
      'top': 0
    }
  });

  chrome.app.window.create('sandboxed.html', {
    'bounds': {
      'width': 400,
      'height': 400,
      'left': 400,
      'top': 0
    }
  });
});
</pre>

<h3 id="embedding_sandbox"><!--@Embedding a sandboxed page in an app page-->在应用页面中嵌入经过沙盒屏蔽的页面</h3>

<p><!--@Sandboxed pages can also be embedded within another app page
  using an <code>iframe</code>:-->
  经过沙盒屏蔽的页面也可以使用 <code>iframe</code> 嵌入至另一个应用页面：
</p>

<pre data-filename="window.html">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;I am normal app window.&lt;/p&gt;

    &lt;iframe src="sandboxed.html" width="300" height="200"&gt;&lt;/iframe&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>


<h2 id="postMessage"><!--@Sending messages to sandboxed pages-->向经过沙盒屏蔽的页面发送消息</h2>

<p>
<!--@There are two parts to sending a message:
you need to post a message from the sender page/window,
and listen for messages on the receiving page/window.-->
发送消息需要两方面同时进行：您需要从发送者页面/窗口投递消息，并在接收端页面/窗口监听消息。
</p>

<h3 id="post_message"><!--@Post message-->投递消息</h3>

<p>
<!--@You can use <code>postMessage</code> to communicate
between your app and sandboxed content.
Here's a sample background script
that posts a message to the sandboxed page it
opens:-->
您可以使用 <code>postMessage</code>
在您的应用与经过沙盒屏蔽的内容间通信。如下是一个后台脚本的示例，向它打开的经过沙盒屏蔽的页面发送消息：
</p>

<pre data-filename="background.js">
var myWin = null;

chrome.app.runtime.onLaunched.addListener(function() {
  chrome.app.window.create('sandboxed.html', {
    'bounds': {
      'width': 400,
      'height': 400
    }
  }, function(win) {
       myWin = win;
       myWin.contentWindow.postMessage('只是打个招呼。', '*');
     });
});
</pre>

<p>
<!--@Generally speaking on the web,
you want to specify the exact origin
from where the message is sent.
Chrome Apps have no access
to the unique origin of sandboxed content,
so you can only whitelist all origins
as acceptable origins ('*').
On the receiving end,
you generally want to check the origin;
but since Chrome Apps content is contained,
it isn't necessary.
To find out more,
see-->
一般从网页的角度来说，您希望指定消息发送方的准确来源。Chrome
应用无法访问经过沙盒屏蔽的内容的唯一来源，所以您只能将所有来源添加到可接受来源的白名单中（'*'）。在接收端，您通常希望检查来源，但是由于
Chrome 应用的内容是受限的，这没有必要。要想了解更多内容，请参见
<a href="https://developer.mozilla.org/en/DOM/window.postMessage">window.postMessage</a><!--@.-->。
</p>

<h3 id="listen_message"><!--@Listen for message-->监听消息</h3>

<p>
<!--@Here's a sample message receiver
that gets added to your sandboxed page:-->
如下是消息接收端的示例，可以添加到经过沙盒屏蔽的页面中去：
</p>

<pre data-filename="sandboxed.html">
var messageHandler = function(e) {
  console.log('后台脚本打了个招呼。', e.data);
};

window.addEventListener('message', messageHandler);
</pre>
    
    <br>
    <footer id="cc-info">
      <!--<button id="send-feedback" class="google-button" data-feedback>Send Feedback</button>-->
      <!--p class="last-updated">Last updated August 2, 2013.</p-->
      <p class="cc-logo">
      该网页翻译自
      <a href="https://developer.chrome.com/extensions/">Google Chrome Extensions</a>
      与
      <a href="https://developer.chrome.com/apps/">Google Chrome Apps</a>，遵循
      <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License <img src="../static/images/cc_by.png" alt="Licensed Creative Commons by Attribution"></a></p>
    </footer>
    <nav class="inline-toc no-permalink">
      <section class="related">
                  <h3 title="">在云端开发</h3>
      <ol class="toc">
                        <li>
                          <a href="offline_apps.html">首先考虑离线</a>
                        </li>
                        <li>
                          <a href="app_external.html" class="active">处理外部内容</a>
                        </li>
                        <li>
                          <a href="app_storage.html">保存数据</a>
                        </li>
                        <li>
                          <a href="inform_users.html">随时通知用户</a>
                        </li>
                        <li>
                          <a href="cloudMessaging.html">云消息服务</a>
                        </li>
                        <li>
                          <a href="richNotifications.html">丰富的通知</a>
                        </li>
                        <li>
                          <a href="app_identity.html">用户认证</a>
                        </li>
      </ol>
      </section>
      <section id="toc">
    <h3><!--@Contents-->目录</h3>
    <ol class="toc">
      <li class="toplevel"><a data-list-item href="app_external.html#external"
          >引用外部资源</a>
          <ol class="toc">
              <li><a data-list-item href="app_external.html#manifest"
                     >清单文件的要求</a>
              </li>
              <li><a data-list-item href="app_external.html#cross-origin"
                     >跨站 XMLHttpRequest</a>
              </li>
          </ol>
      </li>
      <li class="toplevel"><a data-list-item href="app_external.html#webview"
          >嵌入外部网页</a>
          <ol class="toc">
              <li><a data-list-item href="app_external.html#webview_element"
                     >添加 webview 元素</a>
              </li>
              <li><a data-list-item href="app_external.html#properties"
                     >更新属性</a>
              </li>
          </ol>
      </li>
      <li class="toplevel"><a data-list-item href="app_external.html#sandboxing"
          >通过沙盒保护本地内容</a>
          <ol class="toc">
              <li><a data-list-item href="app_external.html#inline_scripts"
                     >在沙盒中使用内嵌脚本</a>
              </li>
              <li><a data-list-item href="app_external.html#include_sandbox"
                     >在清单文件中包含 sandbox</a>
              </li>
              <li><a data-list-item href="app_external.html#opening_sandbox"
                     >在窗口中打开经过沙盒屏蔽的页面</a>
              </li>
              <li><a data-list-item href="app_external.html#embedding_sandbox"
                     >在应用页面中嵌入经过沙盒屏蔽的页面</a>
              </li>
          </ol>
      </li>
      <li class="toplevel"><a data-list-item href="app_external.html#postMessage"
          >向经过沙盒屏蔽的页面发送消息</a>
          <ol class="toc">
              <li><a data-list-item href="app_external.html#post_message"
                     >投递消息</a>
              </li>
              <li><a data-list-item href="app_external.html#listen_message"
                     >监听消息</a>
              </li>
          </ol>
      </li>
    </ol>
</section>

    </nav>
  </div>
</article>
    </main>

    <footer id="gc-footer" role="contentinfo" class="span-full">
      <div class="g-section g-tpl-50-50">
        <div class="g-unit g-first">
          <nav class="links">
            <a href="https://code.google.com/p/crxdoczh/">crxdoczh 项目主页</a>
            <a href="https://code.google.com/p/crxdoczh/issues/entry?template=%E7%BD%91%E7%AB%99%E5%8F%8D%E9%A6%88">发送反馈</a>
            <a href="https://plus.google.com/communities/105384952265487436177">Google+ 社群</a>
          </nav>
        </div>
        <div class="g-unit g-last">
          <div id="social-buttons">
            <div data-size="small" data-annotation="bubble" class="g-plusone"></div>
            <a rel="publisher" target="_blank" href="https://plus.google.com/+Crxdoc-zhAppspot?prsrc=3" data-g-label="plus" data-g-event="nav-subfooter"><!--@Add us on-->在 <span class="element-invisible">Google+</span><img src="https://ssl.gstatic.com/images/icons/gplus-16.png" data-g-label="plus" data-g-event="nav-subfooter" alt=""> 上关注我们</a>
          </div>
        </div>
      </div>
    </footer>

    <script src="../static/js/fatnav.js"></script>
    <script src="../static/js/article.js"></script>
    <script src="../static/js/prettify.js"></script>
    <script src="../static/js/search.js"></script>
    <script src="../static/js/site.js"></script>
  </body>
</html>
