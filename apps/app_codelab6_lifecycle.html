<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">
    <link type="image/ico" rel="icon" href="https://www.google.com/images/icons/product/chrome-32.png">

    <link href="../static/css/out/site.css" rel="stylesheet" type="text/css">
    <link href="../static/css/print.css" rel="stylesheet" type="text/css" media="print">
    <link href="../static/css/prettify.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700%7CSource+Code+Pro' rel='stylesheet' type='text/css'>
    <title>管理应用的生命周期 - Google Chrome 应用开发文档（非官方中文版）</title>
  </head>

  <body>
    <div id="gc-container">
    <a href="app_codelab6_lifecycle.html#gc-pagecontent" class="element-invisible element-focusable">Skip to main content</a>

    <header id="topnav" role="banner">
      <div id="logo">
        <a href="../extensions/index.html" id="goto-original">
          <img alt="Chrome 开发者" src="../static/images/chrome-logo_2x.png">
        </a>
        <span class="collase-icon"><!-- <img src="/static/images/burger-icon.png" class="collase-icon">--></span>
      </div>
      <nav id="fatnav" role="navigation">
      <ul>
          <li class="pillar">
            <span class="toplevel">应用</span>
            <ul class="expandee">
                <li class="submenu">了解基础知识
                  <ul>
                      <li class="category">
                        <a href="about_apps.html">
                        什么是 Chrome 应用？
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="first_app.html">
                        创建第一个应用
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_architecture.html">
                        应用的架构
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_lifecycle.html">
                        应用的生命周期
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="contentSecurityPolicy.html">
                        内容安全策略
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_codelab1_setup.html">
                        通过代码实验室学习
                        </a>
                        <ul>
                            <li><a href="app_codelab1_setup.html">1、设置开发环境</a>
                            </li>
                            <li><a href="app_codelab2_basic.html">2、创建基本应用</a>
                            </li>
                            <li><a href="app_codelab3_mvc.html">3、创建 MVC</a>
                            </li>
                            <li><a href="app_codelab5_data.html">4、保存和获取数据</a>
                            </li>
                            <li><a href="app_codelab6_lifecycle.html">5、管理应用的生命周期</a>
                            </li>
                            <li><a href="app_codelab7_useridentification.html">6、访问用户数据</a>
                            </li>
                            <li><a href="app_codelab8_webresources.html">7、访问网络资源</a>
                            </li>
                            <li><a href="app_codelab_10_publishing.html">8、发布应用</a>
                            </li>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">在云端开发
                  <ul>
                      <li class="category">
                        <a href="offline_apps.html">
                        首先考虑离线
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_external.html">
                        处理外部内容
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_storage.html">
                        保存数据
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="inform_users.html">
                        随时通知用户
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="cloudMessaging.html">
                        云消息服务
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="richNotifications.html">
                        丰富的通知
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_identity.html">
                        用户认证
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">使用低级系统服务
                  <ul>
                      <li class="category">
                        <a href="app_usb.html">
                        USB
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_serial.html">
                        串行端口
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_network.html">
                        网络通信
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_bluetooth.html">
                        蓝牙
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">MVC 架构和框架
                  <ul>
                      <li class="category">
                        <a href="app_frameworks.html">
                        关于 MVC 架构
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="angular_framework.html">
                        使用 AngularJS 建立应用
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="sencha_framework.html">
                        使用 SenchaJS 建立应用
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="game_engines.html">
                        游戏引擎
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">发布应用
                  <ul>
                      <li class="category">
                        <a href="publish_app.html">
                        发布您的应用
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="chrome_apps_on_mobile.html">
                        在移动设备上运行 Chrome 应用
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="google_wallet.html">
                        通过应用获利
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="https://developer.chrome.com/webstore/one_time_payments">
                        一次性付款
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="analytics.html">
                        Analytics（分析）
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">Chrome 平台 API
                  <ul>
                      <li class="category">
                        <a href="api_index.html">
                        JavaScript API
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="manifest.html">
                        清单文件格式
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="tags/webview.html">
                        Webview 标签
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="api_other.html">
                        网页 API
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="app_deprecated.html">
                        禁用的网页特性
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">帮助
                  <ul>
                      <li class="category">
                        <a href="samples.html">
                        示例
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="faq.html">
                        常见问题
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="https://groups.google.com/a/chromium.org/forum/#!forum/chromium-apps">
                        Google 网上论坛
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="http://stackoverflow.com/questions/tagged/google-chrome-app">
                        Stack Overflow
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
            </ul>
          </li>
          <li class="pillar">
            <span class="toplevel">扩展程序</span>
            <ul class="expandee">
                <li class="submenu">了解基础知识
                  <ul>
                      <li class="category">
                        <a href="../extensions/getstarted.html">
                        入门教程
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/overview.html">
                        概述
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/hosting_changes.html">
                        托管扩展程序的更改
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/single_purpose.html">
                        扩展程序质量准测的常见问题
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/event_pages.html">
                        事件页面
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/content_scripts.html">
                        内容脚本
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/activeTab.html">
                        activeTab 权限
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/whats_new.html">
                        新增特性
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">开发扩展程序
                  <ul>
                      <li class="category">
                        <a href="../extensions/a11y.html">
                        辅助功能
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/contentSecurityPolicy.html">
                        内容安全策略
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/xhr.html">
                        跨站 XHR
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/tut_debugging.html">
                        调试
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/i18n.html">
                        国际化支持
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/messaging.html">
                        消息传递
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/tut_migration_to_manifest_v2.html">
                        迁移至清单文件版本 2
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/tut_oauth.html">
                        OAuth
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">发布扩展程序
                  <ul>
                      <li class="category">
                        <a href="../extensions/hosting.html">
                        托管
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/packaging.html">
                        打包
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="https://developer.chrome.com/webstore/one_time_payments">
                        一次性付款
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/autoupdate.html">
                        自动更新
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/external_extensions.html">
                        其他部署选项
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/tut_analytics.html">
                        Google Analytics（分析）
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/themes.html">
                        发布主题
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">Chrome 平台 API
                  <ul>
                      <li class="category">
                        <a href="../extensions/api_index.html">
                        JavaScript API
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/manifest.html">
                        清单文件格式
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/api_other.html">
                        网页 API
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/permission_warnings.html">
                        权限警告
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/permissions.html">
                        可选权限
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/match_patterns.html">
                        匹配表达式
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
                <li class="submenu">帮助
                  <ul>
                      <li class="category">
                        <a href="../extensions/samples.html">
                        示例
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="../extensions/faq.html">
                        常见问题
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="https://groups.google.com/a/chromium.org/forum/#!forum/chromium-extensions">
                        Google 网上论坛
                        </a>
                        <ul>
                        </ul>
                      </li>
                      <li class="category">
                        <a href="http://stackoverflow.com/tags/google-chrome-extension/info">
                        Stack Overflow
                        </a>
                        <ul>
                        </ul>
                      </li>
                  </ul>
                </li>
            </ul>
          </li>
        <li id="search">
          <img src="../static/images/search.png">
          <div class="expandee">
      
      <!-- override search styles set globally by site.css -->
      <style>.gsc-above-wrapper-area, .gsc-result-info {
        font-size: 11px;
      }
      .gs-webResult div, .gs-result div {
        line-height: initial;
      }
      .gs-webResult a, .gs-result a {
        text-decoration: none;
      }
      td.gcsc-branding-img-noclear, .gcsc-branding-img-noclear a {
        width: 51px;
        height: 15px;
        vertical-align: top;
      }
      .gsc-table-result, .gsc-thumbnail-inside, .gsc-url-top {
        padding: 0;
      }
      .gsc-control-cse tr, .gsc-control-cse td, .gsc-control-cse th {
       padding: inherit;
       border: none;
      }
      .gsc-control-cse {
        white-space: normal;
        border: none;
        padding: 0 1em;
      }
      #search .gsc-control-cse img {
        height: inherit;
        width: inherit;
      }
      .gsc-control-cse table {
        margin: initial;
      }
      .gsc-control-cse * {
        box-sizing: initial;
        -webkit-box-sizing: initial;
        -moz-box-sizing: initial;
      }
      #fatnav .expandee .gsc-control-cse a {
       padding: 0;
       color: inherit;
      }
      </style>
      
            <form id="chrome-docs-cse-search-form" action="https://www.google.com/cse">
              <input type="search" id="chrome-docs-cse-input" name="q" placeholder="What are you looking for?">
              <input type="hidden" name="cx" value="016591469675702421090:ddw412-4i6q" />
              <input type="hidden" name="ie" value="UTF-8" />
            </form>
            <gcse:searchresults-only gname="results"></gcse:searchresults-only>
          </div>
        </li>
      </ul>
      </nav>
          </header>

    <main id="gc-pagecontent" role="main">


<article class="article-content">
  <div itemprop="articleBody">

<h1 id="lab_6_lifecycle"><!--@Manage App Lifecycle-->管理应用的生命周期</h1>

<p><!--@Like everything in this world, apps have a lifecycle.  They are installed, launched, restarted, suspended when the system needs to free up resources and uninstalled.  This lab will show you the basics of the Chrome app lifecycle and how its heart, the event page (aka background script), is used.-->
与世界上的所有事物一样，应用也有生命周期。它们会安装、运行、重新启动，在系统需要释放资源时会暂停，还会被卸载。该实验将向您展示
Chrome 应用生命周期的基础知识，以及它的核心——事件页面（即后台脚本）是如何使用的。
</p>

<h2 id="the_event_page"><!--@The event page-->事件页面</h2>

<p><!--@The event page is one of the most important pieces of a Chrome app. It&#39;s responsible for what gets launched, when, and how.
For example, if your app is an instant messenger, you might want your event page to only show a UI when there is a new notification.-->
事件页面是 Chrome 应用最重要的部分之一，它负责确定运行的内容、时间与方式。例如，如果您的应用是一个即时通信工具，您可能希望您的事件页面在有新消息时才显示用户界面。
</p>

<p><!--@For simpler apps, the event page listens to the app lifecycle events and reacts appropriately.
There are two important lifecycle events, <a href=/apps/app.runtime#event-onLaunched>app.runtime.onLaunched</a> and <a href=/apps/app.runtime#event-onRestarted>app.runtime.onRestarted</a>.-->
对于较小的应用，事件页面监听应用生命周期事件，并作出合理的反应。有两个重要的生命周期事件，包括
<a href="app_runtime.html#event-onLaunched">app.runtime.onLaunched</a> 和 <a href="app_runtime.html#event-onRestarted">app.runtime.onRestarted</a>。
</p>

<h2 id="the_onlaunched"><!--@The -->onLaunched <!--@event-->事件</h2>
<p><!--@The --><a href="app_runtime.html#event-onLaunched">app.runtime.onLaunched</a> <!--@event is the most important event.
It fires when the user clicks on your app&#39;s icon with the intent of launching it.
For most simpler apps,
the event page will listen for this event and open a window when it fires.
See
<a href="https://github.com/GoogleChrome/chrome-app-codelab/blob/master/lab6_lifecycle/angularjs/main.js">AngularJS main.js</a> or
<a href="https://github.com/GoogleChrome/chrome-app-codelab/blob/master/lab6_lifecycle/javascript/main.js">JavaScript main.js</a>
for the most common usage.-->
事件是最重要的事件，当用户为了执行而单击您的应用图标时产生。对于大多数较简单的应用来说，事件页面应该监听该事件并在它产生时打开一个窗口。有关这一常见用法，请参见我们的
<a href="https://github.com/GoogleChrome/chrome-app-codelab/blob/master/lab6_lifecycle/angularjs/main.js">AngularJS main.js</a> <!--@or-->或
<a href="https://github.com/GoogleChrome/chrome-app-codelab/blob/master/lab6_lifecycle/javascript/main.js">JavaScript main.js</a>。
</p>

<h3 id="windows_with_ids"><!--@Windows with IDs-->指定了标识符的窗口</h3>

<p><!--@The <a href=/apps/app.window#method-create>app.window.create</a> method can associate an ID to the window being opened. Currently, the most interesting use for this is to restore a window&#39;s width, height and location and its associated Developer Tools window, if opened, when the app is launched. -->
<a href="app_window.html#method-create">app.window.create</a> 方法可以将标识符和打开的窗口关联。目前，最有意思的用途是在应用执行时恢复窗口的宽度、高度和位置，以及与之关联的开发者工具窗口（如果打开的话）。
</p>

<p><!--@Execute your app as it is now, move and resize the window,
close and restart it.
The app will reopen in the original location, right?
Now add a property <code>id</code> to the event page,
<a href="https://github.com/GoogleChrome/chrome-app-codelab/blob/master/lab6_lifecycle/angularjs/main.js">AngularJS main.js</a> or
<a href="https://github.com/GoogleChrome/chrome-app-codelab/blob/master/lab6_lifecycle/javascript/main.js">JavaScript main.js</a>,
reload the app and test again:-->
执行您现在的应用，移动并调整窗口的大小，关闭后在重新启动，应用还是会在原来的位置重新打开，是吗？现在在
<a href="https://github.com/GoogleChrome/chrome-app-codelab/blob/master/lab6_lifecycle/angularjs/main.js">AngularJS main.js</a> 或
<a href="https://github.com/GoogleChrome/chrome-app-codelab/blob/master/lab6_lifecycle/javascript/main.js">JavaScript main.js</a>
中添加一个 <code>id</code> 属性，重新加载应用并再次测试：
</p>

<pre data-filename="main.js">
chrome.app.runtime.onLaunched.addListener(function() {
    chrome.app.window.create(&#39;index.html&#39;,
      {id: &#39;mainwindow&#39;, bounds: {width: 500, height: 309} });
  });
</pre>

<!--@<p>If your application requires, you can open more than one window.</p>-->
<p>如果您的应用程序需要的话，您可以打开一个以上的窗口。</p>

<h2 id="the_onrestarted_event"><!--@The onRestarted event-->onRestarted 事件</h2>

<!--@<p>The <a href=/apps/app.runtime#event-onRestarted>app.runtime.onRestarted</a> event is not as essential as <code>onLaunched</code>,
but it might be relevant to certain types of apps.
This event is executed when the app is restarted, for example,
when Chrome quits, restarts, and the app is launched again.
You can use this event to restore a transient state. </p>-->
<p><a href="app_runtime.html#event-onRestarted">app.runtime.onRestarted</a> 事件不像 <code>onLaunched</code>
那样重要，但是它可能和某些类型的应用相关。当应用重新启动时，例如当 Chrome
浏览器退出、重新启动，再次运行应用时，将会执行该事件。您可以利用该事件恢复临时的状态。</p>

<!--@<p>For example, if your app has a form with several fields,
you won&#39;t always want to save the partial form while the user is typing.
If the user quits the app on purpose, she might not be interested keeping the partial data.
If the Chrome runtime restarted for some reason other than by a user&#39;s intention,
the user will want that data when the app is restarted.</p>-->
<p>例如，如果您的应用有一个表单，包含多个字段，您不会在用户输入时就保存部分的表单。如果用户特意退出您的应用，他们不一定希望保留这部分数据。如果
Chrome 运行时环境由于用户意图以外的原因重新启动，在应用重新启动时用户可能还需要这些数据。</p>

<!--@<p>Let&#39;s change our code to save the Todo input field in <a href=/apps/storage>storage</a> as the user types,
only restoring it if the <code>onRestarted</code> event is triggered.</p>-->
<p>让我们更改我们的代码，将待办事项输入字段保存在 <a href="storage.html">storage</a>
中，只有在 <code>onRestarted</code> 事件触发时才恢复它。</p>

<p class="note"><b><!--@Note:-->注意：</b><!--@
We learned about <code>chrome.storage.sync</code> before, but
<a href="storage#using-sync">chrome.storage.local</a>
wasn&#39;t mentioned until now.
Both have exactly the same syntax,
but the semantics of <code>chrome.storage.local</code> is, as the name says, completely local.
There&#39;s no attempt to synchronize or to save the data in the cloud.-->我们之前学习了
<code>chrome.storage.sync</code>，但是直到现在才提到了
<a href="storage.html#using-sync">chrome.storage.local</a>。它们有完全相同的语法，但是正如它的名称所述，<code>chrome.storage.local</code>
的含义完全是本地的，而不会尝试同步或者将数据保存到云端。
</p>

<h3 id="event-page"><!--@Update event page-->更新事件页面</h3>

<p><!--@Update the event page to include the-->
更新事件页面，包含
<code>onLaunched</code> <!--@and-->和 <code>onRestarted</code> <!--@events.
Events are handled the same in-->
事件。在
<a href="https://github.com/GoogleChrome/chrome-app-codelab/blob/master/lab6_lifecycle/angularjs/main.js">AngularJS main.js</a> <!--@and-->中
<a href="https://github.com/GoogleChrome/chrome-app-codelab/blob/master/lab6_lifecycle/javascript/main.js">JavaScript main.js</a><!--@:-->
处理事件的方式相同：
</p>

<pre data-filename="main.js">
chrome.app.runtime.onLaunched.addListener(function() {
  // normal launch initiated by the user, let&#39;s start clean.
  // note that this is not related to the persistent state, which is
  // appropriately handled in the window code.
  runApp(false);
});

chrome.app.runtime.onRestarted.addListener(function() {
  // if restarted, try to get the transient saved state
  runApp(true);
});

function runApp(readInitialState) {
  chrome.app.window.create(&#39;index.html&#39;,
    {id: &#39;mainwindow&#39;, bounds: {width: 500, height: 309} },
    // the create callback gets a reference to the AppWindow obj
    function(win) {
      // when the callback is executed, the DOM is loaded but no script was
      // loaded yet. So, let&#39;s attach to the load event.
      win.contentWindow.addEventListener(&#39;load&#39;, function() {
        if (readInitialState) {
          win.contentWindow.setInitialState();
        } else {
          win.contentWindow.clearInitialState();
        }
      });
    });
}
</pre>

<h3 id="controller"><!--@Update controller-->更新控制器</h3>

<p><!--@Add to existing-->添加到现有的
<a href="https://github.com/GoogleChrome/chrome-app-codelab/blob/master/lab6_lifecycle/angularjs/controller.js">AngularJS controller.js</a> <!--@or-->或
<a href="https://github.com/GoogleChrome/chrome-app-codelab/blob/master/lab6_lifecycle/javascript/controller.js">JavaScript controller.js</a><!--@:-->：
</p>

<tabs data-group="source">

  <header tabindex="0" data-value="angular">Angular</header>
  <header tabindex="0" data-value="js">JavaScript</header>

  <content>
    <pre data-filename="controller.js">
var newTodoInput = null;

var clearInitialState = function() {
  chrome.storage.local.set({&#39;newtodo&#39;: null});
}

var setInitialState = function() {
  chrome.storage.local.get(&#39;newtodo&#39;, function(data) {
    if (newTodoInput &amp;&amp; data &amp;&amp; data.newtodo) {
      newTodoInput.value = data.newtodo;
      newTodoInput.focus();
    }
  });
}

window.addEventListener(&#39;load&#39;, function() {
  var saveTransientState = function() {
    chrome.storage.local.set({&#39;newtodo&#39;: newTodoInput.value});
  };
  newTodoInput = document.querySelector(&#39;input[type=&quot;text&quot;]&#39;);
  newTodoInput.addEventListener(&#39;keypress&#39; , function() {
    saveTransientState();<br>
  })
})
    </pre>
  </content>
  <content>
    <pre data-filename="controller.js">
  var newTodoInput = document.querySelector('input[type="text"]');
 
  window.clearInitialState = function() {
    chrome.storage.local.set({'newtodo': null});
  }

  window.setInitialState = function() {
    chrome.storage.local.get('newtodo', function(data) {
      if (newTodoInput && data && data.newtodo) {
        newTodoInput.value = data.newtodo;
        newTodoInput.focus();
      }
    });
  };

  var saveTransientState = function() {
    chrome.storage.local.set({'newtodo': newTodoInput.value});
  };

  newTodoInput.addEventListener('keypress' , function() {
    saveTransientState();
  })
    </pre>

</tabs>

<h3 id="results"><!--@Check the results-->检查结果</h3>

<p><!--@Save the changes by reloading the app:
open the app, right-click and select Reload.-->
重新加载应用，检查结果：打开应用，单击右键并选择“重新加载应用”。
</p>

<p><!--@If Chrome and the app shuts down for any reason (other than a user-gesture),
the <code>onRestarted</code> event is fired.
Any text entered in the input field (but not yet saved as a Todo item)
will reappear when Chrome and the app are reopened.-->
如果 Chrome 浏览器和应用由于任何原因（而不是用户操作）关闭，则会产生
<code>onRestarted</code> 事件，输入字段中键入的文本（但是还没有保存为待办事项）会在
Chrome 浏览器和应用重新打开时再次出现。
</p>

<p><!--@If you get stuck and want to see the app in action,
go to-->如果您遇到了困难，希望立刻看到应用，请进入
<code>chrome://extensions</code><!--@,
load the unpacked-->，载入未打包的
<a href="https://github.com/GoogleChrome/chrome-app-codelab/tree/master/lab6_lifecycle/angularjs">AngularJS <!--@app-->应用</a> <!--@or-->或
<a href="https://github.com/GoogleChrome/chrome-app-codelab/tree/master/lab6_lifecycle/javascript">JavaScript <!--@app-->应用</a><!--@,
and launch the app from a new tab.-->，并从新标签页中运行应用。</p>

<h2 id="takeaways_"><!--@Takeaways-->更多信息</h2>

<ul>
<li><!--@The event page may continue to run even when your windows are closed;
you can move logic that is shared amoung windows to the event page.-->
即使当您的窗口都关闭后，事件页面也有可能继续运行。您可以将所有窗口间共享的逻辑移动至事件页面</li>
</ul>

<h2 id="you_should_also_read"><!--@You should also read-->您还应该阅读</h2>

<p><a href="app_lifecycle.html"><!--@Manage App Lifecycle-->管理应用的生命周期</a><!--@ tutorial-->教程</p>

<h2 id="what_39_s_next_"><!--@What's next?-->接下来做什么？</h2>

<p><!--@In-->在 <a href="app_codelab7_useridentification.html">6 - <!--@Access User's Data-->访问用户数据</a><!--@,
you will learn how to identify users and use OAuth2.0 to access Google and other third party services.-->中，您将学习如何认证用户以及如何使用 OAuth2.0
访问 Google 和其他第三方服务。
</p>

<p class="note"><b><!--@Note:-->注意：</b><!--@
The next chapter covers a still experimental API.
If you don't want to play with experimental APIs, feel free to skip it - the
rest of the codelab is independent from it.-->下一章涉及到的 API
仍然是实验性的，如果您不想尝试实验性 API，您可以跳过，代码实验室的剩余部分不依赖它。
</p>
    
    <br>
    <footer id="cc-info">
      <!--<button id="send-feedback" class="google-button" data-feedback>Send Feedback</button>-->
      <!--p class="last-updated">Last updated August 2, 2013.</p-->
      <p class="cc-logo">
      该网页翻译自
      <a href="https://developer.chrome.com/extensions/">Google Chrome Extensions</a>
      与
      <a href="https://developer.chrome.com/apps/">Google Chrome Apps</a>，遵循
      <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License <img src="../static/images/cc_by.png" alt="Licensed Creative Commons by Attribution"></a></p>
    </footer>
    <nav class="inline-toc no-permalink">
      <section class="related">
                      <h3 title="">通过代码实验室学习</h3>
      <ol class="toc">
                              <li>
                                <a href="app_codelab1_setup.html">1、设置开发环境</a>
                              </li>
                              <li>
                                <a href="app_codelab2_basic.html">2、创建基本应用</a>
                              </li>
                              <li>
                                <a href="app_codelab3_mvc.html">3、创建 MVC</a>
                              </li>
                              <li>
                                <a href="app_codelab5_data.html">4、保存和获取数据</a>
                              </li>
                              <li>
                                <a href="app_codelab6_lifecycle.html" class="active">5、管理应用的生命周期</a>
                              </li>
                              <li>
                                <a href="app_codelab7_useridentification.html">6、访问用户数据</a>
                              </li>
                              <li>
                                <a href="app_codelab8_webresources.html">7、访问网络资源</a>
                              </li>
                              <li>
                                <a href="app_codelab_10_publishing.html">8、发布应用</a>
                              </li>
      </ol>
      </section>
      <section id="toc">
    <h3><!--@Contents-->目录</h3>
    <ol class="toc">
      <li class="toplevel"><a data-list-item href="app_codelab6_lifecycle.html#the_event_page"
          >事件页面</a>
      </li>
      <li class="toplevel"><a data-list-item href="app_codelab6_lifecycle.html#the_onlaunched"
          >onLaunched 事件</a>
          <ol class="toc">
              <li><a data-list-item href="app_codelab6_lifecycle.html#windows_with_ids"
                     >指定了标识符的窗口</a>
              </li>
          </ol>
      </li>
      <li class="toplevel"><a data-list-item href="app_codelab6_lifecycle.html#the_onrestarted_event"
          >onRestarted 事件</a>
          <ol class="toc">
              <li><a data-list-item href="app_codelab6_lifecycle.html#event-page"
                     >更新事件页面</a>
              </li>
              <li><a data-list-item href="app_codelab6_lifecycle.html#controller"
                     >更新控制器</a>
              </li>
              <li><a data-list-item href="app_codelab6_lifecycle.html#results"
                     >检查结果</a>
              </li>
          </ol>
      </li>
      <li class="toplevel"><a data-list-item href="app_codelab6_lifecycle.html#takeaways_"
          >更多信息</a>
      </li>
      <li class="toplevel"><a data-list-item href="app_codelab6_lifecycle.html#you_should_also_read"
          >您还应该阅读</a>
      </li>
      <li class="toplevel"><a data-list-item href="app_codelab6_lifecycle.html#what_39_s_next_"
          >接下来做什么？</a>
      </li>
    </ol>
</section>

    </nav>
  </div>
</article>
    </main>

    <footer id="gc-footer" role="contentinfo" class="span-full">
      <div class="g-section g-tpl-50-50">
        <div class="g-unit g-first">
          <nav class="links">
            <a href="https://code.google.com/p/crxdoczh/">crxdoczh 项目主页</a>
            <a href="https://code.google.com/p/crxdoczh/issues/entry?template=%E7%BD%91%E7%AB%99%E5%8F%8D%E9%A6%88">发送反馈</a>
            <a href="https://plus.google.com/communities/105384952265487436177">Google+ 社群</a>
          </nav>
        </div>
        <div class="g-unit g-last">
          <div id="social-buttons">
            <div data-size="small" data-annotation="bubble" class="g-plusone"></div>
            <a rel="publisher" target="_blank" href="https://plus.google.com/+Crxdoc-zhAppspot?prsrc=3" data-g-label="plus" data-g-event="nav-subfooter"><!--@Add us on-->在 <span class="element-invisible">Google+</span><img src="https://ssl.gstatic.com/images/icons/gplus-16.png" data-g-label="plus" data-g-event="nav-subfooter" alt=""> 上关注我们</a>
          </div>
        </div>
      </div>
    </footer>

    <script src="../static/js/fatnav.js"></script>
    <script src="../static/js/article.js"></script>
    <script src="../static/js/prettify.js"></script>
    <script src="../static/js/search.js"></script>
    <script src="../static/js/site.js"></script>
  </body>
</html>
